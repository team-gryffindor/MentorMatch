version: '3'
services:
  web:
    build: ./services/main/
    ports:
      - '80:80'
    restart: always
    # env_file: ./server/.env # TODO - uncomment this to auto-load your .env file!
    environment:
      NODE_ENV: production
      PORT: 80
    volumes:
      - ./services/main:/mainServer/
      - ./services/main/package.json:/mainServer/package.json
      - /mainServer/node_modules
  redisearch:
    image: redislabs/redisearch:latest
    container_name: redisearch
    depends_on:
      - web
    ports:
      - 6379:6379
    volumes:
      - /home/user/data:/data
  search:
    build: ./services/search
    container_name: searchservice
    command: npm start
    depends_on:
      - web
      - redisearch
    ports:
      - 2000:2000
    volumes:
      - ./services/search:/searchService/
      - ./services/search/package.json:/searchService/package.json
      - /searchService/node_modules
